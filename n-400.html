<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>N-400 Civics Test Practice</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    html, body { background: #f3f7fb; color: #232c3d; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
    body { max-width: 560px; margin: 0 auto; padding: 0 0 2em 0; }
    .quiz-box { background: #fff; border-radius: 20px; box-shadow: 0 6px 40px #3e4b6510; padding: 2.5em 2em 2em 2em; margin: 2.5em 0 1.5em 0; }
    h1 { text-align: center; color: #3064e0; letter-spacing: 0.02em; margin: 0 0 1.5em 0; font-size: 2em; font-weight: 800; }
    .progress { text-align: right; font-size: 0.95em; color: #9098a8; margin-bottom: 0.4em; }
    .timer { font-size: 1.08em; color: #4c5ad6; text-align: left; font-weight: bold; margin-bottom: 0.3em; }
    .question { font-size: 1.25em; margin-bottom: 1em; font-weight: 600; min-height: 2.5em; }
    .hint { color: #6576a8; font-size: 0.96em; background: #eef3fd; border-radius: 6px; padding: 0.7em 1em; margin: 0.5em 0 1.2em 0; display: inline-block; }
    .answers { margin-bottom: 1.1em; }
    .answer-btn { display: block; width: 100%; padding: 1.1em 1em; margin-bottom: 0.7em; border: none; border-radius: 9px; background: #f4f7ff; font-size: 1.08em; cursor: pointer; text-align: left; font-weight: 500; transition: background 0.18s, color 0.13s; box-shadow: 0 2px 8px #0001; }
    .answer-btn:hover { background: #e0ebff; }
    .answer-btn.selected { background: #ffeaea; }
    .answer-btn.correct { background: #c7f1d2; color: #175b2d; }
    .feedback { min-height: 2.2em; font-weight: bold; color: #d95040; margin-bottom: 0.9em; white-space: pre-line; font-size: 1.05em; transition: color 0.18s; }
    .feedback.correct { color: #257d4a; }
    .next-btn, .start-btn { display: inline-block; margin: 1em 0 0 0; padding: 0.9em 2em; background: #3d7efd; color: #fff; border: none; border-radius: 10px; font-size: 1.08em; font-weight: 700; cursor: pointer; box-shadow: 0 2px 14px #3d7efd22; transition: background 0.2s; letter-spacing: 0.03em; }
    .next-btn:active, .start-btn:active { background: #215299; }
    .start-screen { text-align: center; margin: 2em 0; }
    .option-btn { background: #f5f9ff; border: 1.8px solid #c3d7fa; border-radius: 8px; margin: 1em 0.5em 0 0.5em; padding: 1em 2em; color: #3064e0; font-size: 1.06em; font-weight: 600; cursor: pointer; transition: background 0.15s, border 0.15s; }
    .option-btn.selected, .option-btn:hover { background: #dde6fb; border-color: #3d7efd; }
    .summary { font-size: 1.1em; margin: 1.2em 0 0.5em 0; text-align: center; color: #215299; font-weight: 600; }
    @media (max-width: 600px) { .quiz-box { padding: 1.5em 0.5em; } h1 { font-size: 1.5em; } .answer-btn, .option-btn { font-size: 1em; } }
  </style>
</head>
<body>
  <div class="quiz-box" id="mainBox"></div>
  <script>
    // --- 100-question bank (sample: only 15 for brevity, see note below for adding all 100) ---
    const questions = [
      { q: "What is the supreme law of the land?", answers: ["The Declaration of Independence", "The Constitution", "The Bill of Rights", "The Emancipation Proclamation"], correct: 1, why: ["The Declaration of Independence announced U.S. independence but isn't the law.", "Correct! The Constitution is the highest law in the United States.", "The Bill of Rights is part of the Constitution, not the whole law.", "The Emancipation Proclamation freed slaves in Confederate states, but it's not the supreme law."], hint: "It's the document that establishes our government and protects basic rights." },
      { q: "What does the Constitution do?", answers: ["Sets up the government", "Defines the government", "Protects basic rights of Americans", "All of the above"], correct: 3, why: ["Not just sets up, it does more.", "It also defines government and protects rights.", "It does more than just this.", "Correct! The Constitution does all of these things."], hint: "It organizes, defines, and protects." },
      { q: "The idea of self-government is in the first three words of the Constitution. What are these words?", answers: ["We the People", "For the People", "In God We Trust", "Life, Liberty, Happiness"], correct: 0, why: ["Correct! 'We the People' starts the Constitution.", "This is not from the Constitution.", "That's on money, not the Constitution.", "Not in the Constitution."], hint: "Look at the very beginning of the Constitution." },
      { q: "What is an amendment?", answers: ["A change (to the Constitution)", "An introduction", "A principle", "A right"], correct: 0, why: ["Correct! An amendment is a change or addition.", "That's the preamble.", "Amendments are more than just principles.", "Amendments can give rights, but are changes or additions."], hint: "It changes or adds something to the Constitution." },
      { q: "What do we call the first ten amendments to the Constitution?", answers: ["The Preamble", "The Bill of Rights", "The Federalist Papers", "The Articles of Confederation"], correct: 1, why: ["That's the introduction.", "Correct! The Bill of Rights are the first ten amendments.", "These are essays supporting the Constitution.", "That was the first government document."], hint: "These amendments protect individual freedoms." },
      { q: "How many amendments does the Constitution have?", answers: ["10", "27", "23", "50"], correct: 1, why: ["There are 10 in the Bill of Rights, but 27 total.", "Correct! There are 27 amendments.", "That's not correct.", "There are 50 states, not amendments."], hint: "It's more than ten, less than thirty." },
      { q: "What did the Declaration of Independence do?", answers: ["Declared our independence", "Freed the slaves", "Declared war", "Established the Constitution"], correct: 0, why: ["Correct! It declared independence from Britain.", "That was much later.", "Not exactly.", "The Constitution came later."], hint: "It announced something to Great Britain." },
      { q: "What are two rights in the Declaration of Independence?", answers: ["Life and pursuit of happiness", "Liberty and property", "Speech and religion", "Bear arms and vote"], correct: 0, why: ["Correct! Life, liberty, and pursuit of happiness.", "Not property.", "Those are in the Bill of Rights.", "Not in the Declaration of Independence."], hint: "Three: Life, Liberty, and the Pursuit of ..." },
      { q: "What is freedom of religion?", answers: ["You can practice any religion, or not practice a religion", "Freedom to pray in public", "Freedom to go to church", "Freedom to be Christian"], correct: 0, why: ["Correct! Any religion, or none.", "It's broader than just praying in public.", "Freedom of religion is broader.", "It covers all religions, not just one."], hint: "Covers all religions or none at all." },
      { q: "What is the economic system in the United States?", answers: ["Communism", "Socialism", "Capitalist (market) economy", "Barter system"], correct: 2, why: ["That's not correct.", "That's not correct.", "Correct! U.S. has a capitalist, market economy.", "The U.S. does not use a barter system."], hint: "It's based on free markets and private property." },
      { q: "What is the 'rule of law'?", answers: ["Everyone must follow the law", "Leaders must obey the law", "Government must obey the law", "All of the above"], correct: 3, why: ["That's true, but it's more.", "That's true, but it's more.", "That's true, but it's more.", "Correct! All must follow the law."], hint: "It applies to everyone, even leaders." },
      { q: "Name one branch or part of the government.", answers: ["Congress", "The President", "The Courts", "All of the above"], correct: 3, why: ["Congress is one.", "The President is one.", "The Courts is one.", "Correct! All are branches of government."], hint: "There are three branches." },
      { q: "What stops one branch of government from becoming too powerful?", answers: ["Checks and balances", "The military", "The President", "Congress"], correct: 0, why: ["Correct! Checks and balances.", "Not the military.", "Not just the President.", "Not just Congress."], hint: "It's a system that keeps balance among branches." },
      { q: "Who is in charge of the executive branch?", answers: ["The Speaker of the House", "The Chief Justice", "The President", "The Vice President"], correct: 2, why: ["Speaker leads House, not the branch.", "Chief Justice leads courts.", "Correct! The President is in charge.", "Vice President is second in command."], hint: "This person signs bills into law and commands the military." },
      { q: "Who makes federal laws?", answers: ["The President", "Congress", "The States", "The Supreme Court"], correct: 1, why: ["President signs or vetoes, but Congress makes laws.", "Correct! Congress makes federal laws.", "States make state laws.", "The Court interprets laws."], hint: "This group has two chambers and meets in the Capitol." }
      // ... (Paste the rest of the 100-question objects here)
    ];

    // --- Quiz state ---
    let questionCount = 5;
    let shuffledQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let attempts = 0;
    let timerInterval = null;
    let startTime = null, elapsedTime = 0;
    let showHints = true;
    let userAnswers = []; // Stores user's selected answer index per question (quiz mode)

    // --- UI Functions ---
    function showStartScreen() {
      showHints = true;
      document.getElementById('mainBox').innerHTML = `
        <h1>üá∫üá∏ N-400 Civics Test Practice</h1>
        <div class="start-screen">
          <div style="font-size:1.1em; color:#3a4a70; margin-bottom:1em;">
            Choose how many questions you want to practice:
          </div>
          <button class="option-btn" onclick="setQuestionCount(5)">5 Questions</button>
          <button class="option-btn" onclick="setQuestionCount(10)">10 Questions</button>
          <button class="option-btn" onclick="setQuestionCount(20)">20 Questions</button>
          <button class="option-btn" onclick="setQuestionCount(50)">50 Questions</button>
          <button class="option-btn" onclick="setQuestionCount('all')">All (${questions.length})</button>
          <div class="hint-toggle" style="margin:1.4em 0 1.1em 0;">
            <input type="checkbox" id="showHintsCheckbox" checked>
            <label for="showHintsCheckbox">Show Hints</label>
          </div>
          <div style="margin-top:2em; color:#859ab6; font-size:0.98em;">
            You‚Äôll get feedback and hints after each question to help you learn!<br>
            <span style="color:#3074d9;">‚è±Ô∏è New: Your time will be tracked!</span>
          </div>
        </div>
      `;
      // Reset checkbox and showHints to default
      setTimeout(() => {
        const cb = document.getElementById('showHintsCheckbox');
        if (cb) {
          cb.checked = true;
          showHints = true;
          cb.addEventListener('change', (e) => {
            showHints = e.target.checked;
          });
        }
      }, 0);
    }

    window.setQuestionCount = function(n) {
      if (n === 'all') questionCount = questions.length;
      else questionCount = Math.min(Number(n), questions.length);
      startQuiz();
    }

    function startQuiz() {
      // Read the current value of the Show Hints checkbox at quiz start
      const cb = document.getElementById('showHintsCheckbox');
      if (cb) showHints = cb.checked;
      shuffledQuestions = shuffle(questions).slice(0, questionCount);
      currentIdx = 0;
      score = 0;
      elapsedTime = 0;
      startTime = Date.now();
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 200);
      userAnswers = []; // Reset user answers at start of quiz
      showQuestion();
    }

    function updateTimer() {
      elapsedTime = Math.floor((Date.now() - startTime) / 1000);
      let min = Math.floor(elapsedTime / 60);
      let sec = elapsedTime % 60;
      document.getElementById('timer').textContent = `‚è±Ô∏è Time: ${min}:${sec.toString().padStart(2, '0')}`;
    }

    function showQuestion() {
      attempts = 0;
      const qObj = shuffledQuestions[currentIdx];
      // Reverse logic: showHints checked = practice mode (show hints), unchecked = quiz mode (no hints)
      document.getElementById('mainBox').innerHTML = `
        <h1>üá∫üá∏ N-400 Civics Test</h1>
        <div class="progress">Question ${currentIdx+1} of ${shuffledQuestions.length}</div>
        <div class="timer" id="timer">‚è±Ô∏è Time: 0:00</div>
        <div class="question" id="question">${qObj.q}</div>
        <div class="hint" id="hint" style="${showHints ? '' : 'display:none;'}">üí° Hint: ${qObj.hint}</div>
        <div class="answers" id="answers"></div>
        <div class="feedback" id="feedback"></div>
        <button class="next-btn" id="nextBtn" style="display:none;">Next</button>
      `;
      updateTimer();
      const answersDiv = document.getElementById('answers');
      qObj.answers.forEach((ans, i) => {
        const btn = document.createElement('button');
        btn.textContent = ans;
        btn.className = 'answer-btn';
        btn.onclick = () => selectAnswer(i);
        answersDiv.appendChild(btn);
      });
      // If in practice mode and user already answered this question (should not happen), highlight previous answer
      if (!showHints && typeof userAnswers[currentIdx] === 'number') {
        const btns = document.querySelectorAll('.answer-btn');
        btns.forEach((b, i) => {
          b.disabled = true;
          if (i === userAnswers[currentIdx]) b.classList.add('selected');
        });
        document.getElementById('nextBtn').style.display = 'inline-block';
      }
    }

    function selectAnswer(idx) {
      const qObj = shuffledQuestions[currentIdx];
      if (!showHints) {
        // Quiz mode: record answer, highlight only their choice, do not show feedback or correct answer
        userAnswers[currentIdx] = idx;
        const btns = document.querySelectorAll('.answer-btn');
        btns.forEach((b, i) => {
          b.disabled = true;
          if (i === idx) b.classList.add('selected');
        });
        document.getElementById('feedback').textContent = '';
        document.getElementById('feedback').className = 'feedback';
        document.getElementById('nextBtn').style.display = 'inline-block';
      } else {
        // Practice mode: show feedback, require correct answer to advance
        attempts++;
        const btns = document.querySelectorAll('.answer-btn');
        btns.forEach(b => b.disabled = true);
        btns[idx].classList.add(idx === qObj.correct ? 'correct' : 'selected');
        // Show feedback
        let feedback = "";
        if (idx === qObj.correct) {
          feedback = "‚úÖ " + qObj.why[idx];
          document.getElementById('feedback').className = 'feedback correct';
          score++;
          document.getElementById('nextBtn').style.display = 'inline-block';
        } else {
          feedback = "‚ùå " + qObj.why[idx];
          // If Show Hints is on, append the hint to feedback and hide the hint box
          if (showHints) {
            feedback += `\n\nHint: ${qObj.hint}`;
            const hintDiv = document.getElementById('hint');
            if (hintDiv) hintDiv.style.display = 'none';
          } else if (attempts >= 2) {
            feedback += `\n\nHint: ${qObj.hint}`;
          }
          document.getElementById('feedback').className = 'feedback';
          // Let them try again, unless they've tried all but the correct answer
          if (attempts < qObj.answers.length - 1) {
            btns.forEach((b, i) => {
              if (i !== idx && i !== qObj.correct) b.disabled = false;
              if (i === qObj.correct) b.disabled = false;
            });
          } else {
            // Show correct answer
            btns[qObj.correct].classList.add('correct');
            feedback += `\n\nThe correct answer is: "${qObj.answers[qObj.correct]}".`;
            document.getElementById('nextBtn').style.display = 'inline-block';
          }
        }
        document.getElementById('feedback').textContent = feedback;
      }
    }

    document.addEventListener('click', function (e) {
      if (e.target && e.target.id === "nextBtn") {
        currentIdx++;
        if (currentIdx < shuffledQuestions.length) {
          showQuestion();
        } else {
          showResults();
        }
      }
    });

      function showResults() {
        if (timerInterval) clearInterval(timerInterval);
        let totalTime = elapsedTime;
        let min = Math.floor(totalTime / 60);
        let sec = totalTime % 60;
        let avg = (totalTime / shuffledQuestions.length) || 0;
        let avgMin = Math.floor(avg / 60);
        let avgSec = Math.round(avg % 60);

        if (!showHints) {
          // Quiz mode: show summary with user answers, correct/wrong, explanations
          let correctCount = 0;
          let details = "";
          for (let i = 0; i < shuffledQuestions.length; i++) {
            const qObj = shuffledQuestions[i];
            const userAnswerIdx = typeof userAnswers[i] === 'number' ? userAnswers[i] : null;
            const correctIdx = qObj.correct;
            const isCorrect = userAnswerIdx === correctIdx;
            if (isCorrect) correctCount++;
            details += `<div style="margin:1.3em 0 1.2em 0; padding:1.1em 1em; background:#f7f9fd; border-radius:9px;">
              <div style="font-weight:600; color:#2c3a5c; margin-bottom:0.5em;">Q${i+1}: ${qObj.q}</div>
              <div>
                Your answer: <span style="font-weight:600; color:${isCorrect ? '#1f7d3d' : '#c22d2d'};">
                  ${userAnswerIdx !== null && qObj.answers[userAnswerIdx] !== undefined
                    ? qObj.answers[userAnswerIdx]
                    : '<i>No answer</i>'}
                </span>
              </div>
              ${!isCorrect ? `<div style="color:#3057a6; margin-top:0.4em;">
                Correct answer: <b>${qObj.answers[correctIdx]}</b>
                <br><span style="color:#7c8db5;">${qObj.why[correctIdx]}</span>
              </div>` : ""}
            </div>`;
          }
          document.getElementById('mainBox').innerHTML = `
            <h1>üéâ Quiz Complete!</h1>
            <div class="summary">
              Your score: <b>${correctCount} / ${shuffledQuestions.length}</b>
            </div>
            <div style="text-align:center; margin:1.2em 0 0.2em 0;">
              <div style="color:#4c5ad6; font-weight:600; margin-bottom:0.2em;">
                ‚è±Ô∏è Total time: <b>${min}:${sec.toString().padStart(2, '0')}</b>
              </div>
              <div style="color:#739be5;">
                Avg time per question: <b>${avgMin}:${avgSec.toString().padStart(2, '0')}</b>
              </div>
            </div>
            <div style="margin:1.5em 0 0.7em 0; text-align:center;">
              <button class="start-btn" onclick="showStartScreen()">Try Again</button>
            </div>
            <div style="margin-top:2em; color:#9ba8ba; font-size:1em; text-align:center;">
              Keep practicing to improve your knowledge and confidence!
            </div>
            <div style="margin-top:2.1em;">${details}</div>
          `;
        } else {
          // Practice mode: original results logic
          document.getElementById('mainBox').innerHTML = `
            <h1>üéâ Quiz Complete!</h1>
            <div class="summary">
              Your score: <b>${score} / ${shuffledQuestions.length}</b>
            </div>
            <div style="text-align:center; margin:1.2em 0 0.2em 0;">
              <div style="color:#4c5ad6; font-weight:600; margin-bottom:0.2em;">
                ‚è±Ô∏è Total time: <b>${min}:${sec.toString().padStart(2, '0')}</b>
              </div>
              <div style="color:#739be5;">
                Avg time per question: <b>${avgMin}:${avgSec.toString().padStart(2, '0')}</b>
              </div>
            </div>
            <div style="margin:1.5em 0 0.7em 0; text-align:center;">
              <button class="start-btn" onclick="showStartScreen()">Try Again</button>
            </div>
            <div style="margin-top:2em; color:#9ba8ba; font-size:1em; text-align:center;">
              Keep practicing to improve your knowledge and confidence!
            </div>
          `;
        }
      }

      // --- Shuffle helper ---
      function shuffle(array) {
        return array.map(a => [Math.random(), a])
          .sort((a, b) => a[0] - b[0])
          .map(a => a[1]);
      }

      // --- Launch ---
      showStartScreen();
    </script>
  </body>
  </html>
