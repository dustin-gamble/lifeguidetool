<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeGuide AI - Powered by Gemini</title>
    <!-- Google Fonts: Poppins & Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-green: #244332;
            --accent-green: #35644a;
            --background: #f9fafb;
            --card-background: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #2c2c2c;
            --text-secondary: #41484f;
            --user-bubble-bg: #e7f3ea;
            --ai-bubble-bg: #f3f4f6;
        }

        body {
            background: var(--background);
            font-family: 'Poppins', 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* --- Header --- */
        .header {
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            padding: 1rem 1.5rem;
            background: var(--card-background);
            border-bottom: 1px solid var(--border-color);
        }
        .header-text { color: var(--primary-green); font-size: 1.5rem; font-weight: 700; }
        .header-subtext { color: var(--accent-green); font-size: 0.9rem; font-weight: 500; margin-left: 8px; }

        /* --- Chat Container --- */
        .chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 0;
            overflow: hidden;
        }

        #chat-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Chat Messages */
        .chat-message {
            display: flex;
            gap: 12px;
            max-width: 90%;
        }
        .chat-message .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }
        .chat-message .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.6;
        }

        .user-message { align-self: flex-end; }
        .user-message .avatar { background-color: var(--accent-green); color: white; }
        .user-message .message-bubble { background-color: var(--user-bubble-bg); border-bottom-right-radius: 4px; }

        .ai-message .avatar { background-color: var(--primary-green); color: white; }
        .ai-message .message-bubble { background-color: var(--ai-bubble-bg); border-bottom-left-radius: 4px; }

        /* AI Message content styling */
        .ai-message code {
            font-family: 'Roboto Mono', monospace;
            background-color: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .ai-message pre {
            background-color: #1f2937;
            color: #f3f4f6;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .ai-message ul, .ai-message ol { padding-left: 20px; }
        .ai-message p { margin: 0 0 10px 0; }
        .ai-message p:last-child { margin-bottom: 0; }
        

        /* --- Input Form --- */
        .input-form-container {
            flex-shrink: 0;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            background: var(--card-background);
        }

        #chat-form {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        #prompt-input {
            flex-grow: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            resize: none;
            height: 24px;
            transition: height 0.2s ease;
        }
        #prompt-input:focus { outline: 2px solid var(--accent-green); }

        #send-button {
            width: 48px;
            height: 48px;
            border: none;
            background-color: var(--accent-green);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        #send-button:hover { background-color: var(--primary-green); }
        #send-button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        #send-button svg { width: 24px; height: 24px; }

        /* Loader inside AI message bubble */
        .loader {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .loader .dot {
            width: 8px; height: 8px; border-radius: 50%;
            background-color: var(--text-secondary);
            animation: pulse 1.4s infinite ease-in-out both;
        }
        .loader .dot:nth-child(1) { animation-delay: -0.32s; }
        .loader .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
    </style>
</head>
<body>

  <header class="header">
    <div class="header-text">LifeGuide AI <span class="header-subtext">with Gemini</span></div>
  </header>

  <div class="chat-container">
    <div id="chat-history">
        <!-- Initial Welcome Message -->
        <div class="chat-message ai-message">
            <div class="avatar">AI</div>
            <div class="message-bubble">
                <p>Hello! I'm LifeGuide's AI assistant. How can I help you navigate your journey today? Feel free to ask me anything about finance, wellness, or personal growth.</p>
            </div>
        </div>
    </div>

    <div class="input-form-container">
        <form id="chat-form">
            <textarea id="prompt-input" placeholder="Ask me anything..." rows="1"></textarea>
            <button id="send-button" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
            </button>
        </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const chatHistory = document.getElementById('chat-history');
        const chatForm = document.getElementById('chat-form');
        const promptInput = document.getElementById('prompt-input');
        const sendButton = document.getElementById('send-button');

        // --- System Prompt to Define AI Persona ---
        let conversationHistory = [
            {
                role: "user",
                parts: [{ text: "You are LifeGuide AI, a helpful and supportive assistant from lifeguidetool.com. Your purpose is to help users navigate life's journey by providing guidance on topics like personal finance, health and wellness, and personal growth. Frame your answers in a practical, encouraging, and safe way. You are a guide, not a definitive authority. Do not provide specific medical, legal, or financial advice, but you can discuss general principles and options related to the tools found on lifeguidetool.com." }]
            },
            {
                role: "model",
                parts: [{ text: "I understand. I am LifeGuide AI. I will act as a supportive guide, focusing on topics relevant to the user's life journey, and I will not give specific professional advice. I'm ready to help." }]
            }
        ];

        // --- Functions ---
        
        function appendMessage(sender, text) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('chat-message', `${sender}-message`);
            const avatar = document.createElement('div');
            avatar.classList.add('avatar');
            avatar.textContent = sender === 'user' ? 'You' : 'AI';
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            if (sender === 'ai' && text === 'loading') {
                messageBubble.innerHTML = `<div class="loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
            } else {
                let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                messageBubble.innerHTML = `<p>${html}</p>`;
            }
            messageWrapper.appendChild(avatar);
            messageWrapper.appendChild(messageBubble);
            chatHistory.appendChild(messageWrapper);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            return messageBubble;
        }

        async function getAIResponse(prompt) {
            conversationHistory.push({ role: "user", parts: [{ text: prompt }] });
            const loadingBubble = appendMessage('ai', 'loading');
            sendButton.disabled = true;

            const apiKey = window.GOOGLE_API_KEY || "";
            if (!apiKey) {
                loadingBubble.innerHTML = "<p>Missing Gemini API key. Set window.GOOGLE_API_KEY before sending.</p>";
                sendButton.disabled = false;
                return;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            const payload = { contents: conversationHistory };
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                let aiText = "Sorry, I couldn't get a response. Please try again.";
                if (result.candidates && result.candidates.length > 0) {
                   aiText = result.candidates[0].content.parts[0].text;
                   conversationHistory.push({ role: "model", parts: [{ text: aiText }] });
                }
                
                // Markdown to HTML conversion
                let html = aiText
                    .replace(/```([\s\S]*?)```/g, (match, p1) => `<pre><code>${p1.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre>`)
                    .replace(/`(.*?)`/g, `<code>$1</code>`)
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                html = html.split('\n').map(line => {
                    if (line.trim().startsWith('* ')) return `<li>${line.trim().substring(2)}</li>`;
                    if (line.trim().match(/^\d+\. /)) return `<li>${line.trim().substring(line.indexOf(' ') + 1)}</li>`;
                    return line;
                }).join('\n');
                html = html.replace(/<li>/g, '<ul><li>').replace(/<\/li>/g, '</li></ul>').replace(/<\/ul>\s*<ul>/g, '');
                html = html.replace(/\n/g, '<br>');

                loadingBubble.innerHTML = `<p>${html}</p>`;

            } catch (error) {
                console.error("Error fetching AI response:", error);
                loadingBubble.innerHTML = `<p>There was an error connecting to the AI: ${error.message}. Please check the console for details.</p>`;
            } finally {
                sendButton.disabled = false;
                promptInput.focus();
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }
        }

        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const prompt = promptInput.value.trim();
            if (prompt && !sendButton.disabled) {
                appendMessage('user', prompt);
                getAIResponse(prompt);
                promptInput.value = '';
                promptInput.style.height = '24px';
            }
        });

        promptInput.addEventListener('input', () => {
            promptInput.style.height = 'auto';
            promptInput.style.height = `${promptInput.scrollHeight}px`;
        });
    });
  </script>

</body>
</html>
