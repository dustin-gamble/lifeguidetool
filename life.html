<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Expectancy Planner</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #eef5fa; }
    .container { display: flex; max-width: 1050px; margin: 48px auto; gap: 36px; }
    .inputs {
      width: 30%;
      background: #fcf8f3;
      padding: 32px 26px;
      border-radius: 18px;
      box-shadow: 0 8px 28px #0001;
      border: 2px solid #eee3c4;
      min-width: 260px;
    }
    .inputs h2 { margin-top: 0; }
    .slider-label { display: flex; justify-content: space-between; margin-bottom: 3px; }
    input[type=range], select {
      width: 100%; margin-bottom: 12px;
      accent-color: #5b93e6;
    }
    .desc { font-size: 0.92em; color: #4a679d; margin-bottom: 6px;}
    .outputs {
      width: 70%;
      background: #f4fafd;
      padding: 32px 30px 22px 30px;
      border-radius: 18px;
      box-shadow: 0 8px 28px #0001;
      border: 2px solid #b2e1f7;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .outputs h2 { margin-top: 0; }
    canvas {
      width: 100% !important;
      height: 400px !important;
      background: #fcfdff;
      border-radius: 14px;
      margin-bottom: 18px;
      border: 1.5px solid #bbdeff;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px #0001;
      min-width: 260px;
      font-size: 1em;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #e5e6f0;
      text-align: center;
    }
    th {
      background: #d2ebf8;
      font-weight: 700;
    }
    .emoji { font-size: 1.18em; }
  </style>
</head>
<body>
  <div class="container">
    <div class="inputs">
      <h2><span class="emoji">ðŸ‘µðŸ‘´</span> Life Expectancy Planner</h2>
      <div>
        <label class="slider-label">
          <span>Gender</span>
        </label>
        <select id="gender">
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>
      <div>
        <label class="slider-label">
          <span>Birth Year</span>
          <span id="birthVal">1990</span>
        </label>
        <input id="birthYear" type="range" min="1960" max="2040" value="1990">
      </div>
      <div>
        <label class="slider-label">
          <span>Weight (lb)</span>
          <span id="weightVal">170</span>
        </label>
        <input id="weight" type="range" min="90" max="300" value="170">
      </div>
      <div>
        <label class="slider-label">
          <span>Exercise/week</span>
          <span id="exerciseVal">2</span>
        </label>
        <input id="exercise" type="range" min="0" max="10" value="2">
        <div class="desc" id="exerciseDesc"></div>
      </div>
      <div>
        <label class="slider-label">
          <span>Food Quality</span>
          <span id="foodVal">Medium</span>
        </label>
        <input id="food" type="range" min="1" max="5" value="3">
        <div class="desc" id="foodDesc"></div>
      </div>
      <div>
        <label class="slider-label">
          <span>Busy/Stress Level</span>
          <span id="stressVal">Average</span>
        </label>
        <input id="stress" type="range" min="1" max="5" value="3">
        <div class="desc" id="stressDesc"></div>
      </div>
    </div>
    <div class="outputs">
      <h2>ðŸ“ˆ Projected Life Expectancy</h2>
      <canvas id="lifeChart"></canvas>
      <table>
        <thead>
          <tr>
            <th>Year</th>
            <th>Age</th>
            <th>Life Expectancy (projected)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="currYearCell"></td>
            <td id="currAgeCell"></td>
            <td id="currLECell"></td>
          </tr>

        </tbody>
      </table>
    </div>
  </div>
  <script>
    // Life expectancy table by birth year & gender
    const leTable = [
      { year: 1960, male: 66, female: 73 },
      { year: 1970, male: 67, female: 74 },
      { year: 1980, male: 70, female: 77 },
      { year: 1990, male: 72, female: 78 },
      { year: 2000, male: 74, female: 79 },
      { year: 2010, male: 76, female: 81 },
      { year: 2020, male: 76, female: 81 },
      { year: 2040, male: 78, female: 83 }
    ];

    function interpolateLE(birth, gender) {
      for (let i = 0; i < leTable.length-1; i++) {
        let y0 = leTable[i], y1 = leTable[i+1];
        if (birth >= y0.year && birth <= y1.year) {
          let f = (birth - y0.year) / (y1.year - y0.year);
          let le = y0[gender] + f * (y1[gender] - y0[gender]);
          return le * 1.08;
        }
      }
      // Extrapolate
      if (birth < leTable[0].year) return leTable[0][gender] * 1.06;
      if (birth > leTable[leTable.length-1].year) return leTable[leTable.length-1][gender] * 1.06;
    }

    function getLEModifiers(weight, exercise, food, stress, gender) {
      // Exercise (0â€“10): <1 = 0yr, 1â€“2 = +1yr, 3â€“4 = +2yr, 5+ = +3yr
      let ex = exercise < 1 ? 0 : (exercise < 3 ? 1 : (exercise < 5 ? 2 : 3));
      // Food quality (1â€“5): 1=â€“2, 2=â€“1, 3=0, 4=+2, 5=+3
      let fq = [-2, -1, 0, 2, 3][food-1];
      // Stress (1â€“5): 1=+2, 2=+1, 3=0, 4=â€“1, 5=â€“2
      let st = [2, 1, 0, -1, -2][stress-1];
      // Weight penalty: <120 = +1yr, 120â€“180 = 0, 180â€“200 = â€“2, 200â€“220 = â€“4, 220â€“240 = â€“6, >240 = â€“8
      let wt = 0;
      if (weight < 120) wt = 1;
      else if (weight < 180) wt = 0;
      else if (weight < 200) wt = -2;
      else if (weight < 220) wt = -4;
      else if (weight < 240) wt = -6;
      else wt = -8;
      return ex + fq + st + wt;
    }

    // Inputs
    const gender = document.getElementById('gender');
    const birthYear = document.getElementById('birthYear');
    const weight = document.getElementById('weight');
    const exercise = document.getElementById('exercise');
    const food = document.getElementById('food');
    const stress = document.getElementById('stress');
    // Table cells
    const currYearCell = document.getElementById('currYearCell');
    const currAgeCell = document.getElementById('currAgeCell');
    const currLECell = document.getElementById('currLECell');
    const age70YearCell = document.getElementById('age70YearCell');
    const age70LECell = document.getElementById('age70LECell');
    const age90YearCell = document.getElementById('age90YearCell');
    const age90LECell = document.getElementById('age90LECell');

    let chart;
    function makeChart() {
      chart = new Chart(document.getElementById('lifeChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Projected Life Expectancy',
            data: [],
            borderWidth: 4,
            pointRadius: 0,
            borderColor: "#357be2",
            backgroundColor: "rgba(53,123,226,0.08)",
            fill: true,
            tension: 0.17
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false }},
          scales: {
            x: {
              title: { display: true, text: 'Year', font: { size: 16, weight: 700 }},
              grid: { color: "#e1e9f3" },
              ticks: { font: { size: 14 } }
            },
            y: {
              title: { display: true, text: 'Age', font: { size: 16, weight: 700 }},
              min: 30, max: 110,
              grid: { color: "#e1e9f3" },
              ticks: { font: { size: 14 } }
            }
          }
        }
      });
    }

    function updatePlot() {
      // Get input values
      let g = gender.value;
      let b = Number(birthYear.value);
      let w = Number(weight.value);
      let ex = Number(exercise.value);
      let fq = Number(food.value);
      let st = Number(stress.value);

      // Baseline LE
      let baseLE = interpolateLE(b, g);
      let mod = getLEModifiers(w, ex, fq, st, g);
      let projLE = baseLE + mod;

      // Years for plot (from this year to death year)
      const thisYear = (new Date()).getFullYear();
      let currAge = thisYear - b;
      let deathYear = Math.round(b + projLE);

      // Build plot arrays
      let labels = [];
      let ages = [];
      for (let y = thisYear; y <= deathYear; y++) {
        labels.push(y);
        ages.push(y - b);
      }
      chart.data.labels = labels;
      chart.data.datasets[0].data = ages;
      chart.update();

      // Table
      currYearCell.textContent = thisYear;
      currAgeCell.textContent = currAge;
      currLECell.textContent = Math.round(projLE);

 }

    // Descriptions for inputs
    const exerciseLevels = [
      "None (sedentary)",
      "Light (1 day/wk)",
      "Moderate (2â€“3 days/wk)",
      "Active (4â€“5 days/wk)",
      "High (6â€“7 days/wk)",
      "Athlete (8+ sessions/wk)",
      "Athlete+"
    ];
    const foodLevels = [
      "Very Poor",
      "Poor",
      "Medium",
      "Good",
      "Excellent"
    ];
    const stressLevels = [
      "Very Low",
      "Low",
      "Average",
      "High",
      "Very High"
    ];

    // Get elements for labels
    const birthVal = document.getElementById('birthVal');
    const weightVal = document.getElementById('weightVal');
    const exerciseVal = document.getElementById('exerciseVal');
    const foodVal = document.getElementById('foodVal');
    const stressVal = document.getElementById('stressVal');
    const exerciseDesc = document.getElementById('exerciseDesc');
    const foodDesc = document.getElementById('foodDesc');
    const stressDesc = document.getElementById('stressDesc');

    function updateLabelsAndPlot() {
      birthVal.textContent = birthYear.value;
      weightVal.textContent = weight.value;
      exerciseVal.textContent = exercise.value;
      exerciseDesc.textContent = exerciseLevels[Number(exercise.value)];
      foodVal.textContent = foodLevels[Number(food.value)-1];
      foodDesc.textContent = foodLevels[Number(food.value)-1] + " quality diet";
      stressVal.textContent = stressLevels[Number(stress.value)-1];
      stressDesc.textContent = stressLevels[Number(stress.value)-1] + " stress";
      updatePlot();
    }

    [gender, birthYear, weight, exercise, food, stress].forEach(el =>
      el.addEventListener('input', updateLabelsAndPlot)
    );

    makeChart();
    updateLabelsAndPlot();
    setTimeout(updatePlot, 200); // Ensure plot shows on load
  </script>
</body>
</html>
